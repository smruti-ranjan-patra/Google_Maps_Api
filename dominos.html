<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Dominos Pizza Delivery Tracking System</title>

		<!-- CSS -->		
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
		<style>
			#address, #zip
			{
				height : 35px;
			} 
		</style>
	</head>
	<body>
		<div id="map_search">
		
			<h3 class="serif mgray">Find Dominos Pizza near you</h3>
		
			<input name="property_address" id="address" size="30" placeholder="Enter Your Address"/>
			<input name="property_zip" id="zip" size="7" placeholder="Zip"/>
			<input name="search_button" id="search_button" class="btn btn-primary" type="button" value="Search" />
		</div>
  		<br>
		<div id="map" style="width: 100%; height: 800px;">
		</div>

		<!-- JavaScripts -->
		<script src="//code.jquery.com/jquery.js"></script>
		<script>
			
			function initMap()
			{
				displayMap();
			}

			String.prototype.ucfirst = function()
			{
				return this.charAt(0).toUpperCase() + this.slice(1);
			}

			var locations = {
				'bermunda' : 'Plot No - M18, Near Higher Station Square, Baramunda, Bhubaneswar, Odisha 751003',
				'kalpana' : 'Plot No. 2266, Corporate Park, Cuttack Rd, Near Kalpana Square, Bhubaneswar, Odisha 751006',
				'kharvel' : 'First & Second Floor, Nandighosh Heights, Part 2, Unit 3, Plot No. 2P, Janpath Road, Kharvel Nagar, Bhubaneswar, Odisha 751001',
				'jaydev' : 'Shop No 6, Ground Floor, Jayadev Vihar, Xavier Crossing, Opposite To Odissi Research Centre, Bhubaneswar, Odisha 751013',
				'patia' : 'Plot No-516/1728/3687, Khata No. 474/2026 & 474/1545, KIIT Road, Patia, Chandrasekharpur, Khurda, Bhubaneswar, Odisha 751031'
				};

			var contacts = {
				'bermunda' : '0674-2355445',
				'kalpana' : '0674-2311152',
				'kharvel' : '0674-2575048',
				'jaydev' : '0674-2300424',
				'patia' : '0674-2726117'
			};

			$(document).on('click', '#search_button', function()
			{
				var address = ($('#address').val() != '') ? $('#address').val() : '';
				var zip = ($('#zip').val() != '') ? $('#zip').val() : '';
				var lat = '';
				var lng = '';

				if(address === '' && zip === '')
				{
					displayMap();
				}
				else
				{
					var url = generateSearchUrl(address, zip);
				}

				$.ajax(
				{
					url: url,
					type: 'GET',
					dataType: 'json',

					success:function(response)
					{
						if(response.status == 'OK')
						{
							lat = (response.results[0].geometry.location.lat);
							lng = (response.results[0].geometry.location.lng);
							displayMap(lat, lng);
						}						
					}
				});
			});

			function generateSearchUrl(address='', zip='')
			{
				var uri = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + encodeURIComponent(address) + encodeURIComponent(zip) + '&key=AIzaSyDp1rkMd-LLB9IT26iCVf3U_3g2iV_hgiw';
				return uri;
			}

			function displayMap(lat=0, lng=0)
			{
				var center_latlng = {lat: 20.276497, lng: 85.826902};
				var map = new google.maps.Map(document.getElementById('map'), {
					center: center_latlng,
					zoom: 12,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				});

				// Define the LatLng coordinates for the polygons' path
				var bermunda_coords = [
					{lat: 20.266201, lng: 85.799878},
					{lat: 20.271917, lng: 85.790351},
					{lat: 20.275540, lng: 85.789793},
					{lat: 20.279928, lng: 85.792626},
					{lat: 20.286030, lng: 85.795378},
					{lat: 20.286910, lng: 85.795234},
					{lat: 20.289145, lng: 85.800575},
					{lat: 20.293003, lng: 85.800503},
					{lat: 20.293279, lng: 85.804304},
					{lat: 20.284940, lng: 85.807581},
					{lat: 20.282003, lng: 85.810185},
					{lat: 20.275636, lng: 85.803806},
					{lat: 20.270705, lng: 85.806766}
				];
				var kalpana_coords = [
					{lat: 20.252680, lng: 85.836327},
					{lat: 20.255152, lng: 85.831672},
					{lat: 20.261483, lng: 85.836796},
					{lat: 20.268219, lng: 85.840874},
					{lat: 20.268355, lng: 85.848525},
					{lat: 20.265680, lng: 85.849752},
					{lat: 20.262058, lng: 85.849102},
					{lat: 20.260975, lng: 85.850582},
					{lat: 20.261009, lng: 85.851628},
					{lat: 20.253899, lng: 85.849066},
					{lat: 20.258808, lng: 85.842607}
				];
				var kharvel_coords = [
					{lat: 20.268491, lng: 85.840968},
					{lat: 20.271792, lng: 85.833132},
					{lat: 20.281811, lng: 85.835287},
					{lat: 20.280844, lng: 85.843936},
					{lat: 20.278880, lng: 85.843814},
					{lat: 20.277855, lng: 85.851734},
					{lat: 20.277912, lng: 85.852311},
					{lat: 20.277229, lng: 85.853252},
					{lat: 20.275880, lng: 85.852522},
					{lat: 20.273983, lng: 85.858078},
					{lat: 20.272087, lng: 85.857717},
					{lat: 20.271139, lng: 85.857248},
					{lat: 20.269074, lng: 85.854361},
					{lat: 20.269307, lng: 85.850329},
					{lat: 20.268110, lng: 85.848288}
				];
				var jaydev_coords = [
					{lat: 20.295310, lng: 85.824882},
					{lat: 20.298154, lng: 85.812251},
					{lat: 20.298776, lng: 85.806536},
					{lat: 20.303163, lng: 85.807823},
					{lat: 20.304250, lng: 85.809239},
					{lat: 20.308274, lng: 85.809669},
					{lat: 20.308395, lng: 85.809068},
					{lat: 20.315148, lng: 85.810318},
					{lat: 20.314645, lng: 85.820244},
					{lat: 20.314262, lng: 85.827338},
					{lat: 20.311606, lng: 85.834075},
					{lat: 20.298779, lng: 85.833125},
					{lat: 20.296912, lng: 85.833329},
					{lat: 20.296960, lng: 85.828889}
				];
				var patia_coords = [
					{lat: 20.326168, lng: 85.820786},
					{lat: 20.327745, lng: 85.805677},
					{lat: 20.333588, lng: 85.806481},
					{lat: 20.334545, lng: 85.806711},
					{lat: 20.337512, lng: 85.807043},
					{lat: 20.337560, lng: 85.807553},
					{lat: 20.338397, lng: 85.807655},
					{lat: 20.342800, lng: 85.807272},
					{lat: 20.354284, lng: 85.806915},
					{lat: 20.354006, lng: 85.813742},
					{lat: 20.356300, lng: 85.813871},
					{lat: 20.356420, lng: 85.815673},
					{lat: 20.356320, lng: 85.819235},
					{lat: 20.357540, lng: 85.819342},
					{lat: 20.357284, lng: 85.822589},
					{lat: 20.358422, lng: 85.823439},
					{lat: 20.358337, lng: 85.827900},
					{lat: 20.355264, lng: 85.827414},
					{lat: 20.342267, lng: 85.822767}
				];


				// Construct the polygons
				var bermunda_area = new google.maps.Polygon({
					paths: bermunda_coords,
					strokeColor: 'red',
					strokeOpacity: 0.5,
					strokeWeight: 0,
					fillColor: 'red',
					fillOpacity: 0.3
				});
				var kalpana_area = new google.maps.Polygon({
					paths: kalpana_coords,
					strokeColor: 'blue',
					strokeOpacity: 0.5,
					strokeWeight: 0,
					fillColor: 'blue',
					fillOpacity: 0.3
				});
				var kharvel_area = new google.maps.Polygon({
					paths: kharvel_coords,
					strokeColor: 'yellow',
					strokeOpacity: 0.5,
					strokeWeight: 0,
					fillColor: 'yellow',
					fillOpacity: 0.3
				});
				var jaydev_area = new google.maps.Polygon({
					paths: jaydev_coords,
					strokeColor: 'green',
					strokeOpacity: 0.5,
					strokeWeight: 0,
					fillColor: 'green',
					fillOpacity: 0.3
				});
				var patia_area = new google.maps.Polygon({
					paths: patia_coords,
					strokeColor: 'cyan',
					strokeOpacity: 0.5,
					strokeWeight: 0,
					fillColor: 'cyan',
					fillOpacity: 0.3
				});

				var polygons = {
					'bermunda' : bermunda_area,
					'kalpana' : kalpana_area,
					'kharvel' : kharvel_area,
					'jaydev' : jaydev_area,
					'patia' : patia_area
				};

				if(lat !== 0 && lng !== 0)
				{
					var latlng = new google.maps.LatLng({lat: lat, lng: lng}); 
					inBounds(latlng, polygons, map);
				}

				bermunda_area.setMap(map);
				kalpana_area.setMap(map);
				kharvel_area.setMap(map);
				jaydev_area.setMap(map);
				patia_area.setMap(map);
				setMarkers(map);
			}

			var pizza_centers = [
					['Bermunda Dominos', 20.278448, 85.796944, 4],
					['Kalpana Dominos', 20.260616, 85.843750, 5],
					['Kharvel Nagar Dominos', 20.275663, 85.843605, 3],
					['Jadev Vihar Dominos', 20.307403, 85.820904, 2],
					['Patia Dominos', 20.353196, 85.824480, 1]
				];

			function setMarkers(map)
			{
				var image = 
				{
					url: 'https://cache.dominos.com/nolo/ca/en/020003/assets/build/images/img/favicon.ico',
					size: new google.maps.Size(32, 32),
					origin: new google.maps.Point(0, 0),
					anchor: new google.maps.Point(0, 32)
				};
				var shape =
				{
					coords: [1, 1, 1, 20, 18, 20, 18, 1],
					type: 'poly'
				};

				for (var i = 0; i < pizza_centers.length; i++)
				{
					var beach = pizza_centers[i];
					var marker = new google.maps.Marker({
						position: {lat: beach[1], lng: beach[2]},
						map: map,
						icon: image,
						shape: shape,
						title: beach[0],
						zIndex: beach[3]
					});
				}
			}

			function inBounds(latlng, polygons, map)
			{
				var found = false;
				var contentString = '<div>Sorry, no delivery to this address</div>';
				for (var area in polygons)
				{
					if(polygons.hasOwnProperty(area))
					{
						found = google.maps.geometry.poly.containsLocation(latlng, polygons[area]) ? true : false;

						if(found == true)
						{
							var marker = new google.maps.Marker({
								position: latlng,
								map: map,
								title: area.ucfirst() + 'branch dominos'
							});

							contentString = '<div><b>Branch : </b>' + area.ucfirst() + '<div><b>Address : </b>' + locations[area] + '</div>' + 
							'<div><b>Call us : </b>' + contacts[area];

							var infowindow = new google.maps.InfoWindow({
								content: contentString
							});

							infowindow.open(map, marker);
							map.setCenter(latlng);
							break;
						}
					}
				}

				if(found == false)
				{
					var marker = new google.maps.Marker({
						position: latlng,
						map: map,
						title: 'Sorry, no delivery'
					});

					var infowindow = new google.maps.InfoWindow({
						content: contentString
					});

					infowindow.open(map, marker);
					map.setCenter(latlng);
				}
			}

		</script>
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDp1rkMd-LLB9IT26iCVf3U_3g2iV_hgiw&libraries=geometry&callback=initMap"
		></script>
	</body>
</html>